<!DOCTYPE html>
<html>
  <head>
    <meta id="dropDown" searchType="{{searchType}}">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href= "https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/homePage.css') }}"
    />
    <title> Book Exchange </title>
  </head>
  <body>
    {% include 'header.html' %}
    <h1 class=recently-listed> Recently Listed </h1>
    <br>
      {% if results is not none:  %}
        {% set length = results|length %} 
          {%  for i in range(length) %}
            
            <div class="info">
              {% set url = "buyerPage?bookid=" + uniqueIds[i] %}
              <a href={{url}}><img src="{{image[i]}}" width="225" height="160"></a>
              <div>
              <a href={{url}} method='get'> Book title: {{results[i][0]}} 
                Course name: {{results[i][1]}} 
                Min price: {{results[i][3]}} ...</a> 
                </div>
            </div>
          {% endfor %}
      {% endif %}
  
    <script src= "https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"> </script>
    <script>

      'use strict';


      function autoComplete(response){
        // return array depending on search

        // call jQuery autocomplete on said list
        $("#searchQuery").autocomplete({
          source: response
         });

        $('#searchQuery').change(function () {
          alert($('#searchQuery').val());
        });

      }


      let request = null;

      function getResults(){

        let searchType = $('#searchType1').val();
        searchType = encodeURIComponent(searchType);
        console.log("searchType: ", searchType);

        let query = $('#searchQuery').val();
        query = encodeURIComponent(query);
        console.log("query: ", query);

        if (searchType !== '' || searchType !== null){
          if(query !== null || query.trim() != ''){
            let url = 'autoComplete?searchType=' + searchType + "&query=" + query
          
            if (request != null) {
				      request.abort();
			      }

			      request = $.ajax(
				      {
					      type: 'GET',
					      url: url, 
					      success: handleResponse
				      }

			      );
          }
        }





		}
      function setup(){
        $('#searchQuery').focus();
        $('#searchQuery').on('input', getResults);
      }
      $('document').ready(setup);
    </script>

    {% include 'footer.html' %}
  </body>
</html>
