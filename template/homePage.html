<!DOCTYPE html>
<html>
  <head>
    <meta id="dropDown" searchType="{{searchType}}">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href= "https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/homePage.css') }}"
    />
    <title> Book Exchange </title>
  </head>
  <body>
  

    {% include 'header.html' %}
    <h1 class=recently-listed> Recently Listed </h1>
    <br>
    <div class="results-container">
      {% if results is not none:  %}
        {%  for dict in results %}         
            <div class="info">
              {% set url = "buyerPage?bookid=" + dict["uniqueId"] %}
              <a href={{url}} method='POST'><img src="{{images[dict['images']]}}" width="225" height="160"></a>
              <div>
              <a href={{url}} method='POST'>
                <div>Book Title: {{dict["title"]}}</div>
                <div>Course Code: {{dict["crscode"]}}</div>
                <div>Min Price: ${{dict["minPrice"]}}</div></a>
                </div>
            </div>
          
          {% endfor %}
      {% endif %}
  
   
  </div>
    <link href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="Stylesheet"></link>
    <script src= "https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"> </script>
    <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.js" ></script>
    <script>

      'use strict';


      function handleResponse(response){
        // return array depending on search

        try
        {
          let results = response;

                  // call jQuery autocomplete on said list
          $("#searchQuery").autocomplete({
            source: results
          });

        }
        catch(e){
          console.log("error: ", e);
        }


      }


      let request = null;

      function getResults(){

        let searchType = $('#searchType1').val();
        searchType = encodeURIComponent(searchType);
        console.log("searchType: ", searchType);

        let query = $('#searchQuery').val();
     
        query = encodeURIComponent(query);
        console.log("query: ", query);

        if (searchType !== '' || searchType !== null){
          if(query !== null || query.trim() != ''){
            let url = 'autoComplete?searchType=' + searchType + "&query=" + query
          
            if (request != null) {
				      request.abort();
			      }

			      request = $.ajax(
				      {
					      type: 'GET',
					      url: url, 
					      success: handleResponse
				      }

			      );
          }
        }





		}
      function setup(){
        $('#searchQuery').focus();
        $('#searchQuery').on('input', getResults);
      }
      $('document').ready(setup);
    </script>

    {% include 'footer.html' %}
  </body>
</html>
