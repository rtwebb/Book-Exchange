<!DOCTYPE html>
<html>
<head>
    <meta id="dropDown" searchType="{{searchType}}">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet"
          type="style/css"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">

    <title> Book Exchange </title>

    <style>
        .thumbnail:hover {
            border: 2px solid orange;
            overflow: hidden;
        }
    </style>

</head>

<body>
    {% include 'head.html' %}

    <div class="container">
        <div class="row" style="margin-bottom:10px">
            <div class="col-md-12">
                <h1 style="text-align:center"> Recently Listed </h1>
                <br>
                {% if results is not none: %}
                <div class="row">
                    {% for dict in results: %}
                    {% set url = "buyerPage?bookid=" + dict["uniqueId"] %}
                    <div class="col-md-3 col-md-offset-2">
                        <div class="thumbnail thumbnails">
                            <a href="{{url}}">
                                <img src="{{images[dict['images']]}}" alt="Lights" width="100%" height="200" class="d-block m-auto">
                                <div class="caption" style="text-align:left">
                                    <hr style="margin-bottom:0;margin-top:5">
                                    <small>
                                        <p style="text-align:center">
                                            Book Title: {{dict["title"]}}
                                            <br>
                                            Highest bid: ${{dict["highestBid"]}}0
                                            <br>
                                            Buy now: ${{dict["buyNow"]}}0
                                        </p>
                                    </small>
                                </div>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    {% include 'footer.html' %}

    <link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="Stylesheet"></link>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script>
        'use strict';

        function handleResponse(response) {
            // return array depending on search
            try {
                let results = response;
                console.log("results: ", results)

                // call jQuery autocomplete on said list
                $("#searchQuery").autocomplete({

                    source: results

                });
            } catch (e) {
                console.log("error: ", e);
            }

        }

        let request = null;

        function getResults() {
            let searchType = $('#searchType1').val();
            searchType = encodeURIComponent(searchType);
            console.log("searchType: ", searchType);

            let query = $('#searchQuery').val();
            console.log('Query: ', query);

            query = encodeURIComponent(query);
            console.log("query: ", query);

            if (query.trim() === ''){
                return false;
            }

            if (searchType !== '' || searchType !== null) {
                if (query !== null || query.trim() !== '') {
                    let url = 'autoComplete?searchType=' + searchType + "&query=" + query;
                    console.log('sending url');

                    if (request != null) {
                        request.abort();
                    }

                    request = $.ajax(
                        {
                            type: 'GET',
                            url: url,
                            success: handleResponse
                        }
                    );
                }
            }
        }

        function setup() {
            $('#searchQuery').focus();
            $('#searchQuery').on('input', getResults);
        }

        $('document').ready(setup);
        </script>

       
</body>
</html>
