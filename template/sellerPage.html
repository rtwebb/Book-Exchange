<!DOCTYPE html>
<html>
  <head>
    <title>Seller's Page</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href= "https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  
    <!--link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/sellerPage.css') }}"
    /-->

  </head>
  
  <body>
    {% include 'header.html' %}

    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <div class="jumbotron">

            <h1 class="sellerHeading">Add a new Listing</h1>

            <form action="sellerPage" method="POST" id="submitBookForm" enctype="multipart/form-data">
              <div class="form-row">
                <div class="form-group col-md-4">
                  <label for="inputTitle" id="title">Book Title</label>
                  <input type="text" class="form-control" name="title" id="title" placeholder="The Practice of Programming" required>
                </div>

                <div class="form-group col-md-4">
                  <label for="inputISBN">ISBN</label>
                  <input type="text" class="form-control" name="isbn" id="isbn" placeholder="1234567890" required>
                </div>

                <div class="form-group col-md-4">
                  <label for="inputAuthors">Authors</label>
                  <input type="text" class="form-control" name="authors" id="authors" placeholder="Professor Dondero">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group col-md-4">
                  <label for="inputCourseTitle">Course Title</label>
                  <input type="text" class="form-control" name="crstitle" id="crstitle" placeholder="Advanced Programming Techniques">
                </div>

                <div class="form-group col-md-4">
                  <label for="inputCode">Course Code</label>
                  <input type="text" class="form-control" name="crscode" id="crscode" placeholder="COS333" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group col-md-2">
                  <label for="inputMin">Minimum Price</label>
                  <input type="number" class="form-control" name="minPrice" id="minPrice" placeholder="$5" required>
                </div>
              
                <div class="form-group col-md-2">
                  <label for="inputBuy">Buy Now Price</label>
                  <input type="text" class="form-control" name="buyNow" id="buyNow" placeholder="$10" required>
                </div>
              </div>

              <div class="centering" id="condition">
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="bookCondition" id="conditionVery" value="veryGood">
                  <label class="form-check-label" for="inlineRadio1">Very Good</label>
                </div>

                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="bookCondition" id="conditionGood" value="good">
                  <label class="form-check-label" for="inlineRadio2">Good</label>
                </div>

                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="bookCondition" id="conditionFair" value="fair">
                  <label class="form-check-label" for="inlineRadio3">Fair</label>
                </div>

                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="bookCondition" id="conditionPoor" value="poor">
                  <label class="form-check-label" for="inlineRadio3">Poor</label>
                </div>

                <br>

                * Required fields
                <h2>Add Images</h2>
                <input type="file" accept="image/*" name="image1">
                <input type="file" accept="image/*" name="image2">
                <input type="file" accept="image/*" name="image3">
                <br> 
                <button type="submit"
                        class="btn orange" 
                        form="submitBookForm"
                        onclick="return verifyListing();"
                        value="Submit">
                  SUBMIT
                </button>
              </div> 
            </form>
          </div>
        </div>
      </div>
    </div>

    {% include 'footer.html' %}


    <link href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="Stylesheet"></link>
    <script src= "https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"> </script>
    <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.js" ></script>
    <script>

      'use strict';
      function verifyListing(){
        
        // make sure none of the required entrys are null
        // if none are null ask if they are sure they want to list - if yes do success listing

        let isbn = $('#isbn').val();
        console.log("isbn: ", isbn);
        let title = $('#title').val();
        console.log("title: ", title);
        let authors = $('#authors').val();
        console.log("authors: ", authors);
        let crscode = $('#crscode').val();
        console.log("crscode: ", crscode);
        let crstitle = $('#crstitle').val();
        console.log("crstitle: ", crstitle);
        let minPrice = $('#minPrice').val();
        minPrice = parseInt(minPrice, 10);
        console.log('Min price: ', minPrice);
        let buyNow = $('#buyNow').val();
        buyNow = parseInt(buyNow, 10);
        console.log('buyNow: ', buyNow);
        let condition1 = $('#conditionVery').val();
        let condition2 = $('#conditionGood').val();
        let condition3 = $('#conditionFair').val();
        let condition4 = $('#conditionPoor').val();

        if (buyNow < minPrice){
          alert('Your buy now price is less than the minimum ask, please update!')
          return false;
        }


        // null value check
        if (isbn == null || title == null || authors == null || crscode == null 
        || crstitle == null || minPrice == null || buyNow == null){
          console.log("in first if statement");
          alert('All required fields are not filled, please make sure you complete all required fields!');
          return false;
        } else if (condition1 == null && condition2 == null && condition3 == null && condtion4 == null){
          console.log("in second if statement");
          alert('All required fields are not filled, please make sure you complete all required fields!');
          return false;
        } else if (isbn.trim() === '' || title.trim() === '' || authors.trim() === '' || crscode.trim() === '' ||
          crstitle.trim() === '' || minPrice.strip() === '' || buyNow.trim() === '') {
          
          alert('All required fields are not filled, please make sure you complete all required fields!');
          return false;
        } else{
          console.log("in third if statement");
          if (confirm('Are you sure you would like to post this listing?')){
            alert("Congratulations!  You have succesfully listed an tem :)!")
            return true;
          }
          else{
            return false;
          }

        }
      }


      function handleResponse(response){
        // return array depending on search

        try
        {
          let results = response;

                  // call jQuery autocomplete on said list
          $("#searchQuery").autocomplete({
            source: results
          });

        }
        catch(e){
          console.log("error: ", e);
        }


      }


      let request = null;

      function getResults(){

        let searchType = $('#searchType1').val();
        searchType = encodeURIComponent(searchType);
        console.log("searchType: ", searchType);

        let query = $('#searchQuery').val();
     
        query = encodeURIComponent(query);
        console.log("query: ", query);

        if (searchType !== '' || searchType !== null){
          if(query !== null || query.trim() !== ''){
            let url = 'autoComplete?searchType=' + searchType + "&query=" + query
          
            if (request != null) {
				      request.abort();
			      }

			      request = $.ajax(
				      {
					      type: 'GET',
					      url: url, 
					      success: handleResponse
				      }

			      );
          }
        }

		}
      function setup(){
        $('#searchQuery').focus();
        $('#searchQuery').on('input', getResults);
      }
      $('document').ready(setup);
    </script>
  </body>
</html>
